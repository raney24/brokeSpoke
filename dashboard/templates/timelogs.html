{% extends 'base.html' %}
{% block content %}
{% load static %}

<head>
  <link rel="stylesheet" href="{% static 'css/timelogs.css' %}">
</head>
<style>
  td[data-href] {
    cursor: pointer;
  }
</style>
<h1 class="timelog-title"><i class="far fa-clock"></i> Timelogs</h1>
<a id="new" href="/timelogs/new" class="btn btn-lg">
  <i class="fas fa-plus"></i> New Timelog
</a>
<div>
  <div class="timelog-group">
    <table class="table display table-bordered compact " style="width:100%" id="myTable">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Start Time</th>
          <th scope="col">End Time Type</th>
          <th scope="col">Activity</th>
          <th scope="col">Hours</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        {% for user in obj %}
        <tr >
          <td data-href="{% url 'timelogs-edit' user.id %}">{{ user.person }}</td>
          <td data-href="{% url 'timelogs-edit' user.id %}">{{ user.startTime }}</td>
          <td data-href="{% url 'timelogs-edit' user.id %}">{{ user.endTime }}</td>
          <td data-href="{% url 'timelogs-edit' user.id %}">{{ user.activity }}</td>
          <td data-href="{% url 'timelogs-edit' user.id %}"></td>
          <td><a class="delete-button" href="#deletemodal" data-toggle="modal" data-id="{{user.id}}" data-target="#deletemodal">
            <i class="far fa-trash-alt"></i>
          </a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>
<!-- DeleteModal -->
<div class="modal fade" id="deletemodal" tabindex="-1" role="dialog" aria-labelledby="deletemodalTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deletemodalLongTitle">Confirm Deletion</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body">
        This will delete the user from the database
      </div>
      <div class="modal-footer form-horizontal">
        <button type="button" id="footer-cancel" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <form action="" class="deleteform" method="POST">{% csrf_token %}
          <button class="btn btn-secondary " id="footer-delete" type="submit"> Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const rows = document.querySelectorAll("td[data-href]");
      rows.forEach(row => {
        row.addEventListener("click", () => {
          window.location.href = row.dataset.href;
        })
      })
    })
  </script>

<script>
  $(document).on('click','.delete-button', function (){
let userID = $(this).data('id');
deleteURL = "usersdelete/" + userID + "/";
console.log(deleteURL);
console.log(userID);
$(document).on('click', '#footer-delete', function(){
  $(".deleteform").attr('action',deleteURL).submit();
  
});

  });
</script>


  {% endblock %}